# ML 모델 개발 남은 작업 체크리스트

> 각 작업은 완료 시 체크박스를 업데이트하고, 증거(커밋 해시, PR 링크, 실행 결과 등)를 기록한다.

---

## 🔴 즉시 필요 (발표/리뷰 준비)

### PR 분리 및 브랜치 정리
- [ ] `package-lock.json` 수정 커밋을 `fix/lockfile-sync` 브랜치로 분리
- [ ] ML 기능을 `feat/will-have-shot-ml` 브랜치로 분리 (또는 현재 브랜치 이름 변경)
- [ ] 각 PR에 `git diff --name-only origin/main...HEAD` 결과 포함
- [ ] PR 본문에 변경 파일 목록 및 영향 범위 명시

**증거**: PR 링크, 브랜치 목록

### 설정 기반 제어 (백엔드)
- [ ] `backend/app/core/config.py`에 다음 설정 추가:
  - `enable_will_have_shot: bool = Field(default=True)`
  - `will_have_shot_model_path: Optional[str] = Field(default=None)`
  - `will_have_shot_threshold: Optional[float] = Field(default=None)`
- [ ] `WillHaveShotPredictor`가 설정에서 값을 읽도록 수정
- [ ] 환경변수로 override 가능하도록 검증
- [ ] `.env.example`에 새 설정 추가

**증거**: 설정 파일 변경, 환경변수 테스트 결과

---

## 🟡 모델 개선 (성능 향상)

### 피처 엔지니어링
- [ ] 시퀀스 피처 추가:
  - 최근 N개 이벤트의 타입 패턴 (예: 최근 5개 이벤트 타입 시퀀스)
  - 최근 N개 이벤트의 결과 패턴 (성공/실패 시퀀스)
  - 이벤트 간격 통계 (mean, std)
- [ ] 시간적 패턴 피처:
  - 이벤트 속도 변화 (이벤트 간 시간 차이)
  - 공격 강도 변화 (최근 10초 vs 이전 10초)
- [ ] 공간 패턴 피처:
  - 볼 이동 경로 (최근 3개 이벤트의 좌표 변화)
  - 선수 위치 분포 (team_id별 평균 위치)
- [ ] 피처 선택/중요도 분석:
  - Feature importance 계산 및 시각화
  - 상관관계 분석 (중복 피처 제거)
- [ ] 데이터셋 빌더 스크립트 업데이트 (`scripts/build_dataset_will_have_shot.py`)

**증거**: 새 피처 목록, 피처 중요도 차트, 성능 개선 수치

### 하이퍼파라미터 튜닝
- [ ] LogisticRegression 튜닝:
  - C: [0.01, 0.1, 1.0, 10.0, 100.0]
  - penalty: ['l1', 'l2', 'elasticnet']
  - solver: ['lbfgs', 'liblinear', 'saga']
- [ ] HistGradientBoostingClassifier 튜닝:
  - max_iter: [50, 100, 200, 300]
  - learning_rate: [0.01, 0.05, 0.1, 0.2]
  - max_depth: [3, 5, 7, 10]
  - min_samples_leaf: [1, 5, 10, 20]
- [ ] GridSearchCV 또는 Optuna 사용
- [ ] Cross-validation으로 안정성 검증
- [ ] 최적 하이퍼파라미터 저장 및 문서화

**증거**: 튜닝 결과 테이블, 성능 비교, 최적 파라미터 값

### 앙상블 모델
- [ ] Voting Classifier 구현:
  - LogisticRegression + HistGradientBoostingClassifier
  - Soft voting vs Hard voting 비교
- [ ] Stacking Classifier 구현:
  - Meta-learner로 LogisticRegression 사용
- [ ] 앙상블 성능 평가 (PR-AUC, Precision, Recall)
- [ ] 앙상블 가중치 최적화
- [ ] 모델 저장 형식 업데이트 (여러 모델 포함)

**증거**: 앙상블 성능 메트릭, 모델 파일 크기, 예측 시간

### 모델 아키텍처 개선
- [ ] LightGBM 시도:
  - 설치 및 기본 모델 학습
  - 하이퍼파라미터 튜닝
  - 성능 비교
- [ ] XGBoost 시도:
  - 설치 및 기본 모델 학습
  - 하이퍼파라미터 튜닝
  - 성능 비교
- [ ] Neural Network (MLP) 시도:
  - 간단한 2-3층 MLP 구현
  - 하이퍼파라미터 튜닝
  - 성능 비교
- [ ] 최종 모델 선택 및 문서화

**증거**: 각 모델 성능 비교표, 최종 선택 근거

---

## 🟢 운영 정책 개선

### 알림 예산 시스템
- [ ] 경기당 최대 알림 수 제한 구현:
  - 설정: `max_alerts_per_game: int = 10`
  - 우선순위: 확률 높은 순서대로 선택
- [ ] Top-K 선택 로직:
  - 각 하프별 최대 K개 알림 (예: K=5)
  - 확률 상위 K개만 알림 발행
- [ ] 알림 예산 추적:
  - 세션별 알림 카운터
  - 예산 초과 시 로깅
- [ ] SessionManager에 알림 예산 로직 통합

**증거**: 코드 구현, 테스트 결과, 설정 파일

### 동적 Threshold 조정
- [ ] 경기 상황 기반 threshold:
  - 점수 차이에 따른 조정
  - 시간대별 조정 (전반/후반)
- [ ] 확률 분포 기반 threshold:
  - 경기별 확률 분포 분석
  - 분위수 기반 threshold (예: 상위 10%)
- [ ] Adaptive threshold 구현:
  - 최근 알림 정확도 기반 조정
  - 피드백 루프 구현
- [ ] 설정 파일에 threshold 정책 추가

**증거**: 동적 threshold 로직, 테스트 케이스, 성능 개선 수치

### 쿨다운 정책 개선
- [ ] 패턴별 쿨다운 설정:
  - `will_have_shot`: 10초
  - `build_up_bias`: 20초
  - `transition_risk`: 15초
  - `final_third_pressure`: 20초
- [ ] 확률 기반 쿨다운:
  - 높은 확률(>0.8)은 쿨다운 무시
  - 낮은 확률(<0.5)은 쿨다운 증가
- [ ] 설정 파일에 쿨다운 정책 추가
- [ ] SessionManager에 패턴별 쿨다운 로직 통합

**증거**: 쿨다운 설정 파일, 테스트 결과, 알림 빈도 비교

---

## 🔵 프론트엔드 개선

### 알림 시각화
- [ ] 확률 시각화:
  - 게이지 차트 (원형 또는 막대)
  - 확률에 따른 색상 변화 (낮음/중간/높음)
- [ ] 알림 타임라인:
  - 경기 시간대별 알림 표시
  - 확률 히스토그램
- [ ] 확률 분포 차트:
  - 전체 알림의 확률 분포
  - 패턴별 확률 분포
- [ ] Chart.js 또는 Recharts 라이브러리 추가

**증거**: 시각화 스크린샷, 라이브러리 추가, 코드 구현

### 필터링/정렬 개선
- [ ] 확률 기준 정렬:
  - 높은 확률 순
  - 낮은 확률 순
- [ ] 패턴별 그룹화:
  - 패턴 타입별 그룹 표시
  - 접기/펼치기 기능
- [ ] 시간대별 필터:
  - 전반/후반 필터
  - 특정 시간대 필터 (예: 0-30분, 30-60분)
- [ ] 다중 필터 조합:
  - 심각도 + 패턴 + 시간대
  - 필터 상태 저장 (localStorage)

**증거**: 필터 UI 스크린샷, 필터 조합 테스트, 코드 구현

### 상세 정보 표시
- [ ] 피처 중요도 표시:
  - 예측에 기여한 상위 5개 피처
  - 피처별 기여도 점수
- [ ] 예측 근거 설명:
  - "이 알림이 생성된 이유" 텍스트
  - 주요 피처 값 표시
- [ ] 유사 사례 링크:
  - 유사한 알림 찾기
  - 과거 알림과 비교
- [ ] 모델 메타데이터 표시:
  - 모델 버전
  - 학습 날짜
  - 성능 지표

**증거**: 상세 정보 UI 스크린샷, 코드 구현, 사용자 피드백

---

## 🟣 백엔드 개선

### 모델 버전 관리
- [ ] 모델 버전 추적:
  - 모델 파일에 버전 정보 포함
  - 버전별 성능 메트릭 저장
- [ ] A/B 테스트 지원:
  - 여러 모델 버전 동시 로드
  - 세션별 모델 버전 할당
  - 성능 비교 로깅
- [ ] 롤백 기능:
  - 이전 모델 버전으로 전환
  - 설정 파일로 모델 버전 지정
- [ ] 모델 레지스트리:
  - 모델 메타데이터 DB (향후 PostgreSQL 활용)
  - 모델 다운로드/업로드 API

**증거**: 버전 관리 시스템, A/B 테스트 결과, 롤백 테스트

### 예측 캐싱
- [ ] 동일 윈도우 재예측 방지:
  - 윈도우 해시 생성 (이벤트 ID + 시간 범위)
  - 캐시 키로 사용
- [ ] Redis 캐싱:
  - 예측 결과 캐싱 (TTL: 60초)
  - 캐시 히트율 모니터링
- [ ] 캐시 무효화:
  - 새 이벤트 추가 시 캐시 무효화
  - 수동 캐시 클리어 API
- [ ] 성능 측정:
  - 캐시 사용 전/후 예측 시간 비교

**증거**: 캐싱 로직, Redis 연결 테스트, 성능 개선 수치

### 배치 예측
- [ ] 여러 게임 동시 분석:
  - 배치 작업 큐 구현 (Celery 또는 RQ)
  - 병렬 처리
- [ ] 비동기 처리:
  - 예측 작업을 백그라운드로 실행
  - 진행률 추적 (WebSocket)
- [ ] 배치 API:
  - `POST /api/batch/predict`: 여러 게임 ID 입력
  - 배치 작업 상태 조회
- [ ] 리소스 관리:
  - 동시 작업 수 제한
  - 메모리 사용량 모니터링

**증거**: 배치 처리 시스템, API 엔드포인트, 성능 테스트

---

## 🟠 추가 라벨 개발

### will_have_goal (슈팅 → 골)
- [ ] 라벨 정의:
  - 슈팅 후 5초 내 골 발생 여부
  - Shot 이벤트 이후 Goal 이벤트 확인
- [ ] 데이터셋 빌더:
  - `scripts/build_dataset_will_have_goal.py` 작성
  - Shot 이벤트 기준으로 윈도우 생성
- [ ] 모델 학습:
  - 피처 엔지니어링 (슈팅 각도, 거리, 위치)
  - 모델 선택 및 튜닝
- [ ] 백엔드 통합:
  - `WillHaveGoalPredictor` 모듈 추가
  - SessionManager에 통합
- [ ] 프론트 표시:
  - "슈팅 후 골 확률" 알림 추가

**증거**: 데이터셋 통계, 모델 성능, 통합 테스트

### will_have_turnover (볼 소유 변화)
- [ ] 라벨 정의:
  - 미래 5초 내 team_id 변화 여부
  - 턴오버 패턴 분석
- [ ] 데이터셋 빌더:
  - `scripts/build_dataset_will_have_turnover.py` 작성
  - team_id 변화 지점 식별
- [ ] 모델 학습:
  - 피처 엔지니어링 (압박 강도, 패스 성공률)
  - 모델 선택 및 튜닝
- [ ] 백엔드 통합:
  - `WillHaveTurnoverPredictor` 모듈 추가
  - SessionManager에 통합
- [ ] 프론트 표시:
  - "턴오버 위험" 알림 추가

**증거**: 데이터셋 통계, 모델 성능, 통합 테스트

### will_enter_final_third (파이널서드 진입)
- [ ] 라벨 정의:
  - 미래 10초 내 final_third 진입 여부
  - end_x > 70 조건
- [ ] 데이터셋 빌더:
  - `scripts/build_dataset_will_enter_final_third.py` 작성
  - final_third 진입 지점 식별
- [ ] 모델 학습:
  - 피처 엔지니어링 (공격 패턴, 침투 지표)
  - 모델 선택 및 튜닝
- [ ] 백엔드 통합:
  - `WillEnterFinalThirdPredictor` 모듈 추가
  - SessionManager에 통합
- [ ] 프론트 표시:
  - "파이널서드 진입 예측" 알림 추가

**증거**: 데이터셋 통계, 모델 성능, 통합 테스트

---

## ⚪ 데이터/인프라 개선

### 데이터 증강
- [ ] AIhub 데이터 활용 계획:
  - 데이터 다운로드 및 전처리
  - Track2 형식으로 변환
  - 데이터 통합 전략 수립
- [ ] 시뮬레이션 데이터 생성:
  - 합성 이벤트 생성 (데이터 증강)
  - GAN 또는 VAE 활용 (향후)
- [ ] 외부 데이터 소스 탐색:
  - 공개 축구 데이터셋 조사
  - API 연동 가능 여부 확인

**증거**: 데이터 소스 목록, 전처리 스크립트, 통합 계획서

### 모니터링/로깅
- [ ] 예측 로그 저장:
  - 모든 예측 요청 로깅 (피처, 확률, 결과)
  - 로그 파일 또는 DB 저장
- [ ] 성능 메트릭 수집:
  - 예측 시간, 메모리 사용량
  - 알림 발행 빈도
- [ ] 알림 정확도 추적:
  - 실제 슈팅 발생 여부 확인
  - Precision/Recall 실시간 계산
- [ ] 대시보드 구축:
  - Grafana 또는 간단한 웹 대시보드
  - 실시간 메트릭 표시

**증거**: 로깅 시스템, 메트릭 수집, 대시보드 스크린샷

### 테스트 커버리지
- [ ] ML 모델 단위 테스트:
  - 피처 추출 함수 테스트
  - 예측기 로드/예측 테스트
  - Edge case 테스트 (빈 윈도우, 결측치)
- [ ] 통합 테스트:
  - SessionManager ML 통합 테스트
  - End-to-end 알림 생성 테스트
- [ ] 성능 테스트:
  - 부하 테스트 (동시 세션)
  - 메모리 누수 검사
- [ ] 테스트 커버리지 목표: 80% 이상

**증거**: 테스트 코드, 커버리지 리포트, 테스트 실행 결과

---

## 📊 우선순위 요약

### 1단계: 발표 준비 (즉시)
1. PR 분리
2. 설정 기반 제어 추가
3. 발표 자료 최종 점검

### 2단계: 모델 개선 (단기, 1-2주)
1. 하이퍼파라미터 튜닝
2. 피처 엔지니어링 (시퀀스 피처)
3. 앙상블 모델

### 3단계: 운영 정책 (중기, 2-4주)
1. 알림 예산 시스템
2. 동적 Threshold
3. 모니터링/로깅

### 4단계: 확장 (장기, 1-2개월)
1. 추가 라벨 개발
2. 프론트 시각화 개선
3. 배치 예측 지원

---

## 📝 작업 기록

### 완료된 작업
- ✅ Phase 0-5 전체 완료
- ✅ 보고서 개선
- ✅ `/api/health` ML 상태 추가
- ✅ 학습 리포트 개선 (threshold sweep, Precision@K, 경기당 알림 수)

### 진행 중인 작업
- (없음)

### 다음 작업 예정
- PR 분리
- 설정 기반 제어 추가

---

*마지막 업데이트: 2026-01-02 (Asia/Seoul)*

